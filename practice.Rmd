---
title: "TIL`r format(Sys.Date(), '%Y%m%d')`"
output: html_document
date: "`r Sys.Date()`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)
pg <- palmerpenguins::penguins
library(tidyverse)
library(caret)
```

## Correlation coefficient in R

### cor

```{r}
cor_body <- pg %>% 
  drop_na() %>% 
  group_by(species) %>% 
  summarise(across(.cols = bill_length_mm:flipper_length_mm, ~cor(., body_mass_g)))
cor_body
```

```{r}
cor_max <- cor_body %>% 
  summarise(across(.cols = bill_length_mm:flipper_length_mm, ~max(.))) %>% 
  summarise(.[which.max(.)])
cor_max
```


```{r}
cor_body %>% 
  filter_all(any_vars(. %in% c(cor_max$bill_depth_mm)))
```


```{r}
cor_body %>% 
  filter(across(.cols = everything(),
                .fns = ~(.x %in% c(cor_max$bill_depth_mm))))
```

â€» filter(), We cannot directly use across() in filter() because we need an extra step to combine the results. ...  

* https://dplyr.tidyverse.org/articles/colwise.html#filter
* https://community.rstudio.com/t/using-filter-with-across-to-keep-all-rows-of-a-data-frame-that-include-a-missing-value-for-any-variable/68442 

```{r}
rowAny <- function(x) rowSums(x) > 0
cor_body %>% 
  filter(
    rowAny(
      across(.cols = everything(),
             .fns = ~(.x %in% c(cor_max$bill_depth_mm))))
  )
```

```{r}
cor_body %>% 
  filter(if_any(.cols = 2:4, ~(. %in% c(cor_max$bill_depth_mm))))
```

